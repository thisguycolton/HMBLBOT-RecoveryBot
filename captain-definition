{
  "schemaVersion": 2,
  "preDeploy": [
    {
      "id": "precompile-assets",
      "name": "Precompile Assets",
      "script": [
        "bundle exec rails assets:precompile RAILS_ENV=production"
      ]
    }
  ],
  "dockerfileLines": [
    "FROM library/ruby:3.2.3-alpine3.19",
    "RUN apk --update add make g++",
    "RUN apk update && apk add git && apk add postgresql-dev",
    "RUN mkdir -p /usr/src/app",
    "WORKDIR /usr/src/app",
    "RUN gem update --system && gem install bundler",
    "COPY Gemfile /usr/src/app/",
    "COPY Gemfile.lock /usr/src/app/",
    "RUN bundle lock --add-platform x86_64-linux-musl",
    "RUN bundle install",
    "COPY . /usr/src/app/",
    "EXPOSE 3000",
    "CMD [\"bundle\", \"exec\", \"rails\", \"s\", \"-b\", \"0.0.0.0\"]"
  ]
}